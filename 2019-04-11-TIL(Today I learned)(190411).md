---
layout: post
title: "TIL(Today I learned)(190411)"
date: 2019-04-11
blog : true
author : Donghoon Song
summary : "Today I learned"
permalink : /TIL/:year/:month/:day/:title
comments: true
tag: TIL
---

IPv4는 defined in RFC 791, part of TCP/IP

특징 : 신뢰성이 보장되지 않는 비연결지향 구조, 주소 지정, 패킷 경로 설정 및 라우팅 기능

데이터그램 : IP 계층의 패킷


- 헤더 (20~60bytes)
    - 20~60바이트 길이
    - 라우팅과 전달에 필요한 정보
- 버전(VER) (4bits)
    - IP 프로토콜의 버전(4비트)
    - 버전에 따라 헤더 구성이 다르므로 올바른 해석을 위해 IP 버전 정보가 필요
    - 버전이 맞지 않은 경우에는 폐기함
    - IPv4 = 0100
    - IPv6 = 0110
1. Header Length(HLEN) (4bits)
    - 데이터그램 헤더의 전체 길이를 4바이트 단위로 표시
    - 표현 가능한 길이 : (2^4 - 1) x 4 (바이트단위) = 60
    - 헤더 최소길이 : 20바이트 (헤더길이 부분에 들어가는 실제값 = 5)
    - 헤더 최대길이 : 60바이트 (헤더길이 부분에 들어가는 실제값 = 15)
    - 헤더의 전체 바이트 수는 헤더 길이에 4를 곱하여 구함
    - 실제 값은 4바이트 단위로 들어감
2. Service type (8bits)
    - 데이터그램 처리 방법과 우선 순위를 표시
    - Qos(Quality of Service) 제공을 위해 사용함
    - Qos : 인터넷이나 네트워크 상에서 전송율, 에러율과 관련된 서비스 품질을 의미
        - 요구사항 : 신뢰성, 속도 보안 등등
        - 초기 IPv4에서는 이것들을 알아서 구현하라고 했었다.
    - 3비트 : 우선순위 지정 필드
    - 4비트 :  서비스 유형
    - 1비트 :  항상 0으로 세팅(사용안함)
    - TOS(Type of Service)는 데이터그램을 전달하는 특정 서비스 품질(Quality of Service) 기능을 제공하려고 고안되었다.
    - 서비스 유형에 따라 지연, 처리량, 신뢰성, 비용(거리X딜레이) 등을 설정할 수 있으며, 상호 배타적이서어서 하나의 값이 1로 설정되면 나머지 값은 무조건 0이다

3.  Total Length (16bits)

- IP 데이터그램의 전체 길이를 바이트 단위로 표시
- 데이터 길이 = 전체 길이 - 헤더길이
- 전체길이의 최댓값 : 2^16 - 1 = 65,535
- 이더넷 프레임에서 작은 데이터그램의 캡슐화
- 전체길이 필드가 필요한 이유 : 실제 데이터와 패딩을 구분해야 하기 때문에

4. Identification (16bits)

- 식별자
- 데이터그램이 단편화되어 재조립했을 경우 같은 ID인지 식별
- 식별자 필드는 유일해야 한다.
- 카운터를 이용해 데이터그램을 보낼때 마다 카운터 값을 1씩 증가
- 모든 단편화된 단편의 헤더에는 식별자 필드가 포함

5. Flags (3bits)

- 데이터그램의 상태나 진위를 나타내기 위함
- D(Do not Fragment)와 M(More Fragment)로 구성
- D값이 1이면 단편화를 하지 않고, 0이면 단편화를 함
- M값이 1이면 마지막 단편화가 아니고 0이면 마지막 단편화

6. Fragmentation offset (13bits)

- 단편 오프셋
- 단편화 되기 전 데이터 시작점으로부터의 차이
- 즉, 전체 데이터그램에서 단편에 포함된 데이터의 시작 위치
- 8바이트 단위로 표시
    - 전체길이 필드가 16비트라서, 단편오프셋도 16비트 만큼 표시가 가능해야 하지만 3비트를 플래그 표시에 사용했으므로, 남은 13비트로 16비트를 표현하기 위해
    - ex) 첫번째 단편의 오프셋 값은 0
    - → 첫번째 단편이므로 시작위치가 0임
    - ex) 두번째 단편부터는 이전에 단편화된 길이를 8로 나누어 계산
    - → 만약, 첫번째가 800바이트였다면 두번째 단편화 오프셋 값은 100
- 데이터의 전체 순서와 전체 길이 크기를 맞춰줌

7. Time to Live (8bits)

- 데이터그램의 수명제한을 위해 사용
- 데이터그램들의 송수신 과정에서 상위계층 프로토콜을 혼란시킬 수 있으므로, 수명제한을 통해 오래된 데이터그램을 폐기한다.
- 홉 수로 수명이 표시
- 라우터가 데이터그램을 처리할 때마다 수명값은 1홉씩 감소, 0이 되면 라우터에서 데이터그램 폐기
- 송신자에서 수명 값을 지정하여 송신
- 일반적으로 예상 경로에 속한 라우터 수의 두배 만큼 지정
- 만약 1로 지정할 경우 데이터그램은 라우터를 벗어나지 못하고 폐기됨

8. Protocol (8bits)

- IP의 서비스를 사용하는 상위 계층 프로토콜
- value : 6 → TCP
- value : 17 → UDP

9. Header checksum (16bits)

- 검사합
- 오류 확인
- 모든 비트가 0이면 오류 없음

10. Source IP address

11. Destination IP address

- Router를 거칠때마다 TTL이 1씩 줄어들고 checksum도 매번 다시 계산해야 한다.
- IPv6는 고속화를 위해 checksum이 없다.
- 요즘 네트워크가 좋아서 에러가 잘 안생긴다. 생겨도 상위계층에 해결을 떠넘긴다.